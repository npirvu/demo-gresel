<!-- Font Awesome (iconos) -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">

<!-- OpenSeadragon -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>

<!-- Annona -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/annona@latest/dist/annona.css">
<script src="https://cdn.jsdelivr.net/npm/annona@latest/dist/annona.min.js"></script>

<!-- Container -->
<div id="visores"></div>

<script>
fetch("{{ '/_data/gresel-metadata.csv' | relative_url }}")
  .then(response => response.text())
  .then(text => {
    const rows = text.trim().split("\n");
    const headers = rows[0].split(",");

    const manifestIndex = headers.indexOf("object_location");

    rows.slice(1).forEach((row, i) => {
      const cols = row.split(",");
      const manifestUrl = cols[manifestIndex];

      if (!manifestUrl) return;

      const viewerId = "annona-" + i;
      const div = document.createElement("div");
      div.id = viewerId;
      div.style.width = "100%";
      div.style.height = "600px";
      div.style.marginBottom = "2rem";

      document.getElementById("visores").appendChild(div);

      new Annona({
        id: viewerId,
        iiifContent: manifestUrl,
        sidePanel: true,
        readOnly: true
      });
    });
  });
</script>