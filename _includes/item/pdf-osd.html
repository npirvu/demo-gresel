<div id="viewer" style="width:100%; height:600px; background:#000"></div>
<div id="pager" style="margin-top:10px; text-align:center">
  <button id="prev">◀ Anterior</button>
  <span id="counter"></span>
  <button id="next">Siguiente ▶</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>

<script>
  const basePath = "{{ page.images_path | relative_url }}";
  const baseName = "{{ page.base_name }}";
  const totalPages = "{{ page.num_pages }}";

  let currentPage = 1;

  const viewer = OpenSeadragon({
    id: "viewer",
    prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
    tileSources: getImageUrl(currentPage)
  });

  function getImageUrl(page) {
    const p = Math.max(1, page); // nunca menor que 1
    const url = `${basePath}/${baseName}-${p}.jpg`;
    console.log("Cargando imagen:", url); // así ves exactamente qué intenta abrir
    return url;
  }

  function updateViewer() {
    viewer.open(getImageUrl(currentPage));
    document.getElementById("counter").textContent =
      `Página ${currentPage} / ${totalPages}`;
  }

  document.getElementById("prev").onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      updateViewer();
    }
  };

  document.getElementById("next").onclick = () => {
    if (currentPage < totalPages) {
      currentPage++;
      updateViewer();
    }
  };

  updateViewer();
</script>
